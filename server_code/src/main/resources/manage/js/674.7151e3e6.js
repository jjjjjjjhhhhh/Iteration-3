"use strict";(self["webpackChunkvue3_nb0"]=self["webpackChunkvue3_nb0"]||[]).push([[674],{29674:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});n(6603),n(62807),n(30989),n(49127),n(60165),n(30845),n(53220),n(81864),n(9765),n(77126),n(57005),n(2968),n(36046),n(59900),n(7116),n(48991),n(27258),n(39826);var l=n(83556),a=n(11702),u=(n(31225),n(60610),n(49583)),i=n(40202),o=n(9479),r=n(79580),d=n(21256),c=n(76809),s=(n(73451),n(70070),{class:"formModel_btn_box"});const f={__name:"formModel",emits:["formModelChange"],setup:function(e,t){var n,a=t.expose,i=t.emit,o=(0,r.oR)(),f=(0,l.Fl)((function(){return o.getters["user/session"]})),v=null===(n=(0,l.FN)())||void 0===n?void 0:n.appContext.config.globalProperties,p="chatmessage",m="消息表",g=(0,u.iH)({}),h=(0,u.iH)({uid:!1,fid:!1,content:!1,format:!1,isRead:!1}),w=(0,u.iH)(!1),_=(0,u.iH)(!1),b=(0,u.iH)(""),k=(0,u.iH)({uid:[{required:!0,message:"请输入",trigger:"blur"}],fid:[{required:!0,message:"请输入",trigger:"blur"}],content:[],format:[{validator:v.$toolUtil.validator.intNumber,trigger:"blur"}],isRead:[{validator:v.$toolUtil.validator.intNumber,trigger:"blur"}]}),y=(0,u.iH)(null),W=(0,u.iH)(0),U=(0,u.iH)(""),x=function(){g.value={uid:"",fid:"",content:"",format:""}},H=function(){null===v||void 0===v||v.$http({url:"".concat(p,"/info/").concat(W.value),method:"get"}).then((function(e){new RegExp("../../../file","g");g.value=e.data.data,w.value=!0}))},C=(0,u.iH)(""),z=(0,u.iH)(""),R=(0,u.iH)(""),V=(0,u.iH)(""),$=(0,u.iH)(""),Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(x(),e&&(W.value=e,U.value=t),"add"==t)_.value=!0,b.value="新增"+m,w.value=!0;else if("info"==t)_.value=!1,b.value="查看"+m,H();else if("edit"==t)_.value=!0,b.value="修改"+m,H();else if("cross"==t){for(var r in _.value=!0,b.value=n,l)"uid"!=r?"fid"!=r?"content"!=r?"format"!=r?"isRead"!=r||(g.value.isRead=l[r],h.value.isRead=!0):(g.value.format=l[r],h.value.format=!0):(g.value.content=l[r],h.value.content=!0):(g.value.fid=l[r],h.value.fid=!0):(g.value.uid=l[r],h.value.uid=!0);l&&(C.value=l),a&&(z.value=a),i&&(R.value=i),u&&(V.value=u),o&&($.value=o),w.value=!0}};a({init:Z});var N=function(){w.value=!1},j=function(){var e=(0,c.Z)((0,d.Z)().mark((function e(){var t,n,l,a,u;return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(z.value,t=JSON.parse(JSON.stringify(C.value)),n="",l="",a="","cross"==U.value&&""!=V.value)if(V.value.startsWith("["))n=f.value.id,l=t["id"],a=V.value.replace(/\[/,"").replace(/\]/,"");else{for(u in t)u==V.value&&(t[u]=$.value);M(t)}y.value.validate((function(e){if(e)if(n&&l){g.value.crossuserid=n,g.value.crossrefid=l;var t={page:1,limit:1e3,crossuserid:g.value.crossuserid,crossrefid:g.value.crossrefid};null===v||void 0===v||v.$http({url:"".concat(p,"/page"),method:"get",params:t}).then((function(e){if(e.data.data.total>=a)return null===v||void 0===v||v.$toolUtil.message("".concat(R.value),"error"),!1;null===v||void 0===v||v.$http({url:"".concat(p,"/").concat(g.value.id?"update":"save"),method:"post",data:g.value}).then(function(){var e=(0,c.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i("formModelChange"),null===v||void 0===v||v.$toolUtil.message("操作成功","success"),w.value=!1;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}else null===v||void 0===v||v.$http({url:"".concat(p,"/").concat(g.value.id?"update":"save"),method:"post",data:g.value}).then(function(){var e=(0,c.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:i("formModelChange"),null===v||void 0===v||v.$toolUtil.message("操作成功","success"),w.value=!1;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());else v.$message.error("请完善信息")}));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=function(){var e=(0,c.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("cross"!=U.value){e.next=3;break}return e.next=3,null===v||void 0===v?void 0:v.$http({url:"".concat(z.value,"/update"),method:"post",data:t}).then((function(e){}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return function(e,t){var n=(0,l.up)("el-input"),a=(0,l.up)("el-form-item"),u=(0,l.up)("el-col"),i=(0,l.up)("el-row"),o=(0,l.up)("el-form"),r=(0,l.up)("el-button"),d=(0,l.up)("el-dialog");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(d,{"modal-class":"edit_form_modal",class:"edit_form",modelValue:w.value,"onUpdate:modelValue":t[5]||(t[5]=function(e){return w.value=e}),title:b.value,width:"50%","destroy-on-close":"",fullscreen:!1},(0,l.Nv)({default:(0,l.w5)((function(){return[(0,l.Wm)(o,{class:"formModel_form",ref_key:"formRef",ref:y,model:g.value,rules:k.value},{default:(0,l.w5)((function(){return[(0,l.Wm)(i,null,{default:(0,l.w5)((function(){return[(0,l.Wm)(u,{span:24},{default:(0,l.w5)((function(){return[(0,l.Wm)(a,{label:"用户id",prop:"uid"},{default:(0,l.w5)((function(){return[(0,l.Wm)(n,{class:"list_inp",modelValue:g.value.uid,"onUpdate:modelValue":t[0]||(t[0]=function(e){return g.value.uid=e}),placeholder:"用户id",type:"text",readonly:!(_.value&&!h.value.uid)},null,8,["modelValue","readonly"])]})),_:1})]})),_:1}),(0,l.Wm)(u,{span:24},{default:(0,l.w5)((function(){return[(0,l.Wm)(a,{label:"好友id",prop:"fid"},{default:(0,l.w5)((function(){return[(0,l.Wm)(n,{class:"list_inp",modelValue:g.value.fid,"onUpdate:modelValue":t[1]||(t[1]=function(e){return g.value.fid=e}),placeholder:"好友id",type:"text",readonly:!(_.value&&!h.value.fid)},null,8,["modelValue","readonly"])]})),_:1})]})),_:1}),(0,l.Wm)(u,{span:24},{default:(0,l.w5)((function(){return[(0,l.Wm)(a,{label:"内容",prop:"content"},{default:(0,l.w5)((function(){return[(0,l.Wm)(n,{class:"list_inp",modelValue:g.value.content,"onUpdate:modelValue":t[2]||(t[2]=function(e){return g.value.content=e}),placeholder:"内容",type:"text",readonly:!(_.value&&!h.value.content)},null,8,["modelValue","readonly"])]})),_:1})]})),_:1}),(0,l.Wm)(u,{span:24},{default:(0,l.w5)((function(){return[(0,l.Wm)(a,{label:"格式(1:文字，2:图片)",prop:"format"},{default:(0,l.w5)((function(){return[(0,l.Wm)(n,{class:"list_inp",modelValue:g.value.format,"onUpdate:modelValue":t[3]||(t[3]=function(e){return g.value.format=e}),modelModifiers:{number:!0},placeholder:"格式(1:文字，2:图片)",type:"text",readonly:!(_.value&&!h.value.format)},null,8,["modelValue","readonly"])]})),_:1})]})),_:1}),(0,l.Wm)(u,{span:24},{default:(0,l.w5)((function(){return[(0,l.Wm)(a,{label:"消息已读(0:未读，1:已读)",prop:"isRead"},{default:(0,l.w5)((function(){return[(0,l.Wm)(n,{class:"list_inp",modelValue:g.value.isRead,"onUpdate:modelValue":t[4]||(t[4]=function(e){return g.value.isRead=e}),modelModifiers:{number:!0},placeholder:"消息已读(0:未读，1:已读)",type:"text",readonly:!(_.value&&!h.value.isRead)},null,8,["modelValue","readonly"])]})),_:1})]})),_:1})]})),_:1})]})),_:1},8,["model","rules"])]})),_:2},[_.value||"logistics"==U.value||"reply"==U.value?{name:"footer",fn:(0,l.w5)((function(){return[(0,l._)("span",s,[(0,l.Wm)(r,{class:"cancel_btn",onClick:N},{default:(0,l.w5)((function(){return[(0,l.Uk)("取消")]})),_:1}),(0,l.Wm)(r,{class:"confirm_btn",type:"primary",onClick:j},{default:(0,l.w5)((function(){return[(0,l.Uk)(" 提交 ")]})),_:1})])]})),key:"0"}:void 0]),1032,["modelValue","title"])])}}};var v=n(97319);const p=(0,v.Z)(f,[["__scopeId","data-v-3a4bd7de"]]),m=p;var g=function(e){return(0,l.dD)("data-v-33431356"),e=e(),(0,l.Cn)(),e},h={class:"center_view"},w={class:"list_search_view"},_={class:"btn_view"},b=g((function(){return(0,l._)("i",{class:"iconfont icon-xinzeng4"},null,-1)})),k=g((function(){return(0,l._)("i",{class:"iconfont icon-shanchu4"},null,-1)})),y=g((function(){return(0,l._)("i",{class:"iconfont icon-sousuo5"},null,-1)})),W=g((function(){return(0,l._)("i",{class:"iconfont icon-xiugai5"},null,-1)})),U=g((function(){return(0,l._)("i",{class:"iconfont icon-shanchu4"},null,-1)}));const x={__name:"list",setup:function(e){var t,n=(0,r.oR)(),d=((0,l.Fl)((function(){return n.getters["user/session"]})),(0,u.iH)(n.state.user.avatar),null===(t=(0,l.FN)())||void 0===t?void 0:t.appContext.config.globalProperties),c="chatmessage",s="消息表";(0,i.yj)(),(0,i.tv)();(0,l.bv)((function(){}));var f=(0,u.iH)(null),v=(0,u.iH)(null),p=(0,u.iH)({page:1,limit:10,sort:"id",order:"desc"}),g=(0,u.iH)({}),x=(0,u.iH)([]),H=(0,u.iH)(!1),C=function(e){(0,l.Y3)((function(){v.value.toggleRowSelection(e)}))},z=function(){H.value=!0;var e=JSON.parse(JSON.stringify(p.value));e["sort"]="id",e["order"]="desc",d.$http({url:"".concat(c,"/page"),method:"get",params:e}).then((function(e){H.value=!1,f.value=e.data.data.list,$.value=Number(e.data.data.total)}))},R=function(e){var t=(0,u.iH)([]);if(e)t.value=[e];else{if(!x.value.length)return!1;for(var n in x.value)t.value.push(x.value[n].id)}o.T.confirm("是否删除选中".concat(s),"提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((function(){d.$http({url:"".concat(c,"/delete"),method:"post",data:t.value}).then((function(e){null===d||void 0===d||d.$toolUtil.message("删除成功","success",(function(){z()}))}))}))["catch"]((function(e){}))},V=function(e){x.value=e},$=(0,u.iH)(0),Z=(0,u.iH)(["total","prev","pager","next","sizes","jumper"]),N=function(e){p.value.limit=e,z()},j=function(e){p.value.page=e,z()},M=function(e,t){return null===d||void 0===d?void 0:d.$toolUtil.isAuth(e,t)},q=function(){p.value.page=1,z()},S=(0,u.iH)(null),F=function(){q()},J=function(){S.value.init()},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?S.value.init(e,"edit"):x.value.length&&S.value.init(x.value[0].id,"edit")},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?S.value.init(e,"info"):x.value.length&&S.value.init(x.value[0].id,"info")},P=function(){z()};return P(),function(e,t){var n=(0,l.up)("el-form"),u=(0,l.up)("el-button"),i=(0,l.up)("el-table-column"),o=(0,l.up)("el-table"),r=(0,l.up)("el-pagination"),d=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l._)("div",h,[(0,l._)("div",w,[(0,l.Wm)(n,{model:g.value,class:"search_form"},null,8,["model"]),(0,l._)("div",_,[M("chat_message","新增")?((0,l.wg)(),(0,l.j4)(u,{key:0,class:"add_btn",type:"success",onClick:J},{default:(0,l.w5)((function(){return[b,(0,l.Uk)(" 新增 ")]})),_:1})):(0,l.kq)("",!0),M("chat_message","删除")?((0,l.wg)(),(0,l.j4)(u,{key:1,class:"del_btn",type:"danger",disabled:!x.value.length,onClick:t[0]||(t[0]=function(e){return R(null)})},{default:(0,l.w5)((function(){return[k,(0,l.Uk)(" 删除 ")]})),_:1},8,["disabled"])):(0,l.kq)("",!0)])]),M("chat_message","查看")?(0,l.wy)(((0,l.wg)(),(0,l.j4)(o,{key:0,border:"",stripe:!1,onSelectionChange:V,ref_key:"table",ref:v,data:f.value,onRowClick:C},{default:(0,l.w5)((function(){return[(0,l.Wm)(i,{resizable:!0,align:"left","header-align":"left",type:"selection",width:"55"}),(0,l.Wm)(i,{label:"序号",width:"70",resizable:!0,align:"left","header-align":"left"},{default:(0,l.w5)((function(e){return[(0,l.Uk)((0,a.zw)((p.value.page-1)*p.value.limit+e.$index+1),1)]})),_:1}),(0,l.Wm)(i,{"min-width":"140",resizable:!0,sortable:!0,align:"left","header-align":"left",prop:"uid",label:"用户id"},{default:(0,l.w5)((function(e){return[(0,l.Uk)((0,a.zw)(e.row.uid),1)]})),_:1}),(0,l.Wm)(i,{"min-width":"140",resizable:!0,sortable:!0,align:"left","header-align":"left",prop:"fid",label:"好友id"},{default:(0,l.w5)((function(e){return[(0,l.Uk)((0,a.zw)(e.row.fid),1)]})),_:1}),(0,l.Wm)(i,{"min-width":"140",resizable:!0,sortable:!0,align:"left","header-align":"left",prop:"content",label:"内容"},{default:(0,l.w5)((function(e){return[(0,l.Uk)((0,a.zw)(e.row.content),1)]})),_:1}),(0,l.Wm)(i,{"min-width":"140",resizable:!0,sortable:!0,align:"left","header-align":"left",prop:"format",label:"格式(1:文字，2:图片)"},{default:(0,l.w5)((function(e){return[(0,l.Uk)((0,a.zw)(e.row.format),1)]})),_:1}),(0,l.Wm)(i,{"min-width":"140",resizable:!0,sortable:!0,align:"left","header-align":"left",prop:"isRead",label:"消息已读(0:未读，1:已读)"},{default:(0,l.w5)((function(e){return[(0,l.Uk)((0,a.zw)(e.row.isRead),1)]})),_:1}),(0,l.Wm)(i,{label:"操作",width:"300",resizable:!0,sortable:!0,align:"left","header-align":"left"},{default:(0,l.w5)((function(e){return[M("chat_message","查看")?((0,l.wg)(),(0,l.j4)(u,{key:0,class:"view_btn",type:"info",onClick:function(t){return D(e.row.id)}},{default:(0,l.w5)((function(){return[y,(0,l.Uk)(" 查看 ")]})),_:2},1032,["onClick"])):(0,l.kq)("",!0),M("chat_message","修改")?((0,l.wg)(),(0,l.j4)(u,{key:1,class:"edit_btn",type:"primary",onClick:function(t){return O(e.row.id)}},{default:(0,l.w5)((function(){return[W,(0,l.Uk)(" 修改 ")]})),_:2},1032,["onClick"])):(0,l.kq)("",!0),M("chat_message","删除")?((0,l.wg)(),(0,l.j4)(u,{key:2,class:"del_btn",type:"danger",onClick:function(t){return R(e.row.id)}},{default:(0,l.w5)((function(){return[U,(0,l.Uk)(" 删除 ")]})),_:2},1032,["onClick"])):(0,l.kq)("",!0)]})),_:1})]})),_:1},8,["data"])),[[d,H.value]]):(0,l.kq)("",!0),(0,l.Wm)(r,{background:"",layout:Z.value.join(","),total:$.value,"page-size":p.value.limit,"current-page":p.value.page,"onUpdate:currentPage":t[1]||(t[1]=function(e){return p.value.page=e}),"prev-text":"上一页","next-text":"下一页","hide-on-single-page":!1,style:{},"page-sizes":[10,20,30,40,50,100],onSizeChange:N,onCurrentChange:j},null,8,["layout","total","page-size","current-page"])]),(0,l.Wm)(m,{ref_key:"formRef",ref:S,onFormModelChange:F},null,512)])}}},H=(0,v.Z)(x,[["__scopeId","data-v-33431356"]]),C=H}}]);
//# sourceMappingURL=674.7151e3e6.js.map