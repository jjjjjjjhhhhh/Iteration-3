{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nrequire(\"core-js/modules/es.number.constructor.js\");\nrequire(\"core-js/modules/es.array.splice.js\");\nrequire(\"core-js/modules/es.array.join.js\");\nrequire(\"core-js/modules/es.array.push.js\");\nrequire(\"core-js/modules/es.array.for-each.js\");\nrequire(\"core-js/modules/es.object.to-string.js\");\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\nrequire(\"core-js/modules/es.string.starts-with.js\");\nrequire(\"core-js/modules/es.regexp.exec.js\");\nrequire(\"core-js/modules/es.string.match.js\");\nrequire(\"core-js/modules/es.function.name.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nvar _vue = require(\"vue\");\nvar _default = {\n  __name: 'upload',\n  props: {\n    action: String,\n    limit: {\n      type: Number,\n      \"default\": 3\n    },\n    multiple: {\n      type: Boolean,\n      \"default\": false\n    },\n    fileUrls: String,\n    tip: {\n      type: String,\n      \"default\": '请上传'\n    },\n    type: {\n      type: String,\n      \"default\": 'img'\n    },\n    disabled: {\n      type: Boolean,\n      \"default\": false\n    }\n  },\n  emits: ['change'],\n  setup: function setup(__props, _ref) {\n    var _getCurrentInstance;\n    var expose = _ref.expose,\n      emit = _ref.emit;\n    expose();\n    var props = __props;\n    var context = (_getCurrentInstance = (0, _vue.getCurrentInstance)()) === null || _getCurrentInstance === void 0 ? void 0 : _getCurrentInstance.appContext.config.globalProperties;\n\n    //props\n\n    //data\n    var tips = (0, _vue.ref)('请上传');\n    var uploadUrl = (0, _vue.ref)('');\n    var fileList = (0, _vue.ref)([]);\n    var fileUrlList = (0, _vue.ref)([]);\n    var _toRefs = (0, _vue.toRefs)(props),\n      action = _toRefs.action,\n      fileUrls = _toRefs.fileUrls,\n      limit = _toRefs.limit,\n      multiple = _toRefs.multiple,\n      tip = _toRefs.tip,\n      type = _toRefs.type,\n      disabled = _toRefs.disabled;\n    var dialogImageUrl = (0, _vue.ref)('');\n    var dialogVisible = (0, _vue.ref)(false);\n    var uploadHeaders = (0, _vue.ref)({});\n    (0, _vue.watch)(fileUrls, function () {\n      init();\n    });\n    // // methods\n\n    //移除\n    var handleRemove = function handleRemove(e) {\n      fileUrlList.value.splice(e.uid - 1, 1);\n      fileUrlsChange(fileUrlList.value);\n      emit('change', fileUrlList.value.join(','));\n    };\n    //查看图片\n    var handlePictureCardPreview = function handlePictureCardPreview(e) {\n      dialogImageUrl.value = e.url;\n      dialogVisible.value = true;\n    };\n    //成功回调\n    var uploadSuccess = function uploadSuccess(e, file, fileList) {\n      fileUrlList.value.push(\"file/\" + e.file);\n      fileUrlsChange(fileUrlList.value);\n      emit('change', fileUrlList.value.join(','));\n    };\n    var uploadError = function uploadError(e) {\n      context === null || context === void 0 ? void 0 : context.$toolUtil.message('上传失败', 'error');\n    };\n    var uploadPreview = function uploadPreview(e) {\n      window.open(e.url);\n    };\n    //处理上传图片\n    var fileUrlsChange = function fileUrlsChange(list) {\n      var token = context === null || context === void 0 ? void 0 : context.$toolUtil.storageGet(\"token\");\n      var list1 = [];\n      var list2 = [];\n      list.forEach(function (item, index) {\n        var url = item.split(\"?\")[0];\n        var url1 = '';\n        if (!url.startsWith(\"http\")) {\n          url1 = (context === null || context === void 0 ? void 0 : context.$config.url) + url;\n        }\n        var name = item.match(/(?<=\\/)(\\w|\\W)+$/)[0];\n        var file = {\n          name: name,\n          url: url1 + \"?token=\" + token,\n          uid: index + 1\n        };\n        list1.push(file);\n        list2.push(url);\n      });\n      fileList.value = list1;\n      fileUrlList.value = list2;\n    };\n    //超出数量\n    var uploadExceed = function uploadExceed() {\n      context === null || context === void 0 ? void 0 : context.$toolUtil.message(\"\\u6700\\u591A\\u4E0A\\u4F20\".concat(limit.value, \"\\u4E2A\\u6587\\u4EF6\"), 'error');\n    };\n    //created\n    var init = function init() {\n      uploadUrl.value = (context === null || context === void 0 ? void 0 : context.$config.name) + '/' + action.value;\n      uploadHeaders.value = {\n        'Token': context === null || context === void 0 ? void 0 : context.$toolUtil.storageGet(\"Token\")\n      };\n      if (tip.value) {\n        tips.value = tip.value;\n      }\n      var list = [];\n      if (fileUrls.value) {\n        list = fileUrls.value.split(',');\n      }\n      fileUrlsChange(list);\n    };\n    init();\n    var __returned__ = {\n      context: context,\n      emit: emit,\n      props: props,\n      tips: tips,\n      uploadUrl: uploadUrl,\n      fileList: fileList,\n      fileUrlList: fileUrlList,\n      action: action,\n      fileUrls: fileUrls,\n      limit: limit,\n      multiple: multiple,\n      tip: tip,\n      type: type,\n      disabled: disabled,\n      dialogImageUrl: dialogImageUrl,\n      dialogVisible: dialogVisible,\n      uploadHeaders: uploadHeaders,\n      handleRemove: handleRemove,\n      handlePictureCardPreview: handlePictureCardPreview,\n      uploadSuccess: uploadSuccess,\n      uploadError: uploadError,\n      uploadPreview: uploadPreview,\n      fileUrlsChange: fileUrlsChange,\n      uploadExceed: uploadExceed,\n      init: init,\n      ref: _vue.ref,\n      getCurrentInstance: _vue.getCurrentInstance,\n      toRefs: _vue.toRefs,\n      watch: _vue.watch\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};\nexports[\"default\"] = _default;","map":{"version":3,"mappings":"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","names":["context","appContext","config","globalProperties","tips","uploadUrl","fileList","fileUrlList","props","action","fileUrls","limit","multiple","tip","type","disabled","dialogImageUrl","dialogVisible","uploadHeaders","init","handleRemove","e","value","splice","uid","fileUrlsChange","emit","join","handlePictureCardPreview","url","uploadSuccess","file","push","uploadError","$toolUtil","message","uploadPreview","window","open","list","token","storageGet","list1","list2","forEach","item","index","split","url1","startsWith","$config","name","match","uploadExceed"],"sources":["C:/Users/24831/Desktop/Y/毕业设计/projectB/迭代2/manage_code/src/components/common/upload.vue"],"sourcesContent":["<template>\r\n\t<div>\r\n\t\t<el-upload v-if=\"type=='img'\" class=\"img-uploader\" :action=\"uploadUrl\" list-type=\"picture-card\" :limit=\"limit\" :multiple=\"multiple\"\r\n\t\t\tv-model:file-list=\"fileList\" :on-success=\"uploadSuccess\" :on-exceed=\"uploadExceed\" :disabled=\"disabled\"\r\n\t\t\t:headers=\"uploadHeaders\" accept=\"image/*\">\r\n\t\t\t<el-icon>\r\n\t\t\t\t<Plus />\r\n\t\t\t</el-icon>\r\n\t\t\t<template #file=\"{ file }\">\r\n\t\t\t\t<div style=\"width: 100%;height: 100%;\">\r\n\t\t\t\t\t<img class=\"el-upload-list__item-thumbnail\" :src=\"file.url\" alt=\"\" style=\"object-fit: cover;\" />\r\n\t\t\t\t\t<span class=\"el-upload-list__item-actions\">\r\n\t\t\t\t\t\t<span class=\"el-upload-list__item-preview\" @click=\"handlePictureCardPreview(file)\">\r\n\t\t\t\t\t\t\t<el-icon>\r\n\t\t\t\t\t\t\t\t<zoom-in />\r\n\t\t\t\t\t\t\t</el-icon>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t<span v-if=\"!disabled\" class=\"el-upload-list__item-delete\" @click=\"handleRemove(file)\">\r\n\t\t\t\t\t\t\t<el-icon>\r\n\t\t\t\t\t\t\t\t<Delete />\r\n\t\t\t\t\t\t\t</el-icon>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\t\t\t</template>\r\n\t\t\t<template #tip v-if=\"!disabled\">\r\n\t\t\t\t<div class=\"el-upload__tip\">\r\n\t\t\t\t\t{{tips}}\r\n\t\t\t\t</div>\r\n\t\t\t</template>\r\n\t\t</el-upload>\r\n\t\t<el-upload v-else class=\"upload-demo\" drag :action=\"uploadUrl\" :headers=\"uploadHeaders\" :limit=\"limit\"\r\n\t\t\t:multiple=\"multiple\" v-model:file-list=\"fileList\" :on-preview=\"uploadPreview\" multiple\r\n\t\t\t:on-success=\"uploadSuccess\" :on-error=\"uploadError\" :on-exceed=\"uploadExceed\" :on-remove=\"handleRemove\" :disabled=\"disabled\">\r\n\t\t\t<el-icon class=\"el-icon--upload\">\r\n\t\t\t\t<upload-filled />\r\n\t\t\t</el-icon>\r\n\t\t\t<div class=\"el-upload__text\">\r\n\t\t\t\t将文件拖到此处，或<em>点击上传</em>\r\n\t\t\t</div>\r\n\t\t\t<template #tip>\r\n\t\t\t\t<div class=\"el-upload__tip\">\r\n\t\t\t\t\t{{tips}}\r\n\t\t\t\t</div>\r\n\t\t\t</template>\r\n\t\t</el-upload>\r\n\t\t<el-dialog v-model=\"dialogVisible\" width=\"60%\">\r\n\t\t\t<img w-full :src=\"dialogImageUrl\" alt=\"Preview Image\" style=\"width: 100%;\" />\r\n\t\t</el-dialog>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tgetCurrentInstance,\r\n\t\ttoRefs,\r\n\t\tdefineEmits,\r\n\t\twatch\r\n\t} from 'vue'\r\n\tconst context = getCurrentInstance()?.appContext.config.globalProperties;\r\n\tconst emit = defineEmits(['change'])\r\n\t//props\r\n\tconst props = defineProps({\r\n\t\taction: String,\r\n\t\tlimit: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 3\r\n\t\t},\r\n\t\tmultiple: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tfileUrls: String,\r\n\t\ttip: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: '请上传'\r\n\t\t},\r\n\t\ttype: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'img'\r\n\t\t},\r\n\t\tdisabled: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t}\r\n\t})\r\n\t//data\r\n\tconst tips = ref('请上传')\r\n\tconst uploadUrl = ref('')\r\n\tconst fileList = ref([])\r\n\tconst fileUrlList = ref([])\r\n\tconst {\r\n\t\taction,\r\n\t\tfileUrls,\r\n\t\tlimit,\r\n\t\tmultiple,\r\n\t\ttip,\r\n\t\ttype,\r\n\t\tdisabled\r\n\t} = toRefs(props)\r\n\tconst dialogImageUrl = ref('')\r\n\tconst dialogVisible = ref(false)\r\n\tconst uploadHeaders = ref({})\r\n\r\n\twatch(fileUrls, () => {\r\n\t\tinit()\r\n\t})\r\n\t// // methods\r\n\r\n\t//移除\r\n\tconst handleRemove = (e) => {\r\n\t\tfileUrlList.value.splice(e.uid - 1, 1)\r\n\t\tfileUrlsChange(fileUrlList.value)\r\n\t\temit('change', fileUrlList.value.join(','))\r\n\t}\r\n\t//查看图片\r\n\tconst handlePictureCardPreview = (e) => {\r\n\t\tdialogImageUrl.value = e.url\r\n\t\tdialogVisible.value = true\r\n\t}\r\n\t//成功回调\r\n\tconst uploadSuccess = (e, file, fileList) => {\r\n\t\tfileUrlList.value.push(\"file/\" + e.file)\r\n\t\tfileUrlsChange(fileUrlList.value)\r\n\t\temit('change', fileUrlList.value.join(','))\r\n\t}\r\n\tconst uploadError = (e) => {\r\n\t\tcontext?.$toolUtil.message('上传失败', 'error')\r\n\t}\r\n\tconst uploadPreview = (e) => {\r\n\t\twindow.open(e.url)\r\n\t}\r\n\t//处理上传图片\r\n\tconst fileUrlsChange = (list) => {\r\n\t\tvar token = context?.$toolUtil.storageGet(\"token\");\r\n\t\tvar list1 = []\r\n\t\tvar list2 = []\r\n\t\tlist.forEach(function(item, index) {\r\n\t\t\tvar url = item.split(\"?\")[0];\r\n\t\t\tvar url1 = ''\r\n\t\t\tif (!url.startsWith(\"http\")) {\r\n\t\t\t\turl1 = context?.$config.url + url\r\n\t\t\t}\r\n\t\t\tvar name = item.match(/(?<=\\/)(\\w|\\W)+$/)[0];\r\n\t\t\tvar file = {\r\n\t\t\t\tname: name,\r\n\t\t\t\turl: url1 + \"?token=\" + token,\r\n\t\t\t\tuid: index + 1\r\n\t\t\t};\r\n\t\t\tlist1.push(file);\r\n\t\t\tlist2.push(url);\r\n\t\t});\r\n\t\tfileList.value = list1;\r\n\t\tfileUrlList.value = list2;\r\n\t}\r\n\t//超出数量\r\n\tconst uploadExceed = () => {\r\n\t\tcontext?.$toolUtil.message(`最多上传${limit.value}个文件`, 'error')\r\n\t}\r\n\t//created\r\n\tconst init = () => {\r\n\t\tuploadUrl.value = context?.$config.name + '/' + action.value\r\n\t\tuploadHeaders.value = {\r\n\t\t\t'Token': context?.$toolUtil.storageGet(\"Token\")\r\n\t\t}\r\n\t\tif (tip.value) {\r\n\t\t\ttips.value = tip.value\r\n\t\t}\r\n\t\tlet list = []\r\n\t\tif (fileUrls.value) {\r\n\t\t\tlist = fileUrls.value.split(',')\r\n\t\t}\r\n\t\tfileUrlsChange(list)\r\n\t}\r\n\tinit()\r\n</script>\r\n\r\n<style>\r\n\t.el-upload__tip {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: flex-start;\r\n\t}\r\n\t.el-upload-list.is-disabled .el-upload--picture-card{\r\n\t\tdisplay: none;\r\n\t}\r\n\t.el-upload-list__item-actions {\r\n\t\t--color: #fff;\r\n\t}\r\n</style>"]},"metadata":{},"sourceType":"script","externalDependencies":[]}