{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"C:/Users/24831/Desktop/Y/\\u6BD5\\u4E1A\\u8BBE\\u8BA1/projectB/\\u8FED\\u4EE32/manage_code/node_modules/@babel/runtime/helpers/interopRequireDefault.js\")[\"default\"];\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nrequire(\"core-js/modules/es.number.constructor.js\");\nrequire(\"core-js/modules/web.timers.js\");\nrequire(\"core-js/modules/es.date.to-string.js\");\nrequire(\"core-js/modules/es.function.name.js\");\nrequire(\"core-js/modules/es.object.define-property.js\");\nvar _vue = require(\"vue\");\nvar _moment = _interopRequireDefault(require(\"moment\"));\nvar _default = {\n  __name: 'list',\n  setup: function setup(__props, _ref) {\n    var _getCurrentInstance;\n    var expose = _ref.expose;\n    expose();\n    var context = (_getCurrentInstance = (0, _vue.getCurrentInstance)()) === null || _getCurrentInstance === void 0 ? void 0 : _getCurrentInstance.appContext.config.globalProperties;\n    var list = (0, _vue.ref)([]);\n    var listQuery = (0, _vue.ref)({\n      page: 1,\n      limit: 20,\n      sort: 'id',\n      order: 'desc',\n      isreply: 1\n    });\n    var listLoading = (0, _vue.ref)(false);\n    //获取列表\n    var getList = function getList() {\n      var params = listQuery.value;\n      listLoading.value = true;\n      context === null || context === void 0 ? void 0 : context.$http({\n        url: 'chat/page',\n        method: 'get',\n        params: params\n      }).then(function (res) {\n        listLoading.value = false;\n        list.value = res.data.data.list;\n        total.value = Number(res.data.data.total);\n      });\n    };\n    //分页\n    var total = (0, _vue.ref)(0);\n    var layouts = (0, _vue.ref)([\"total\", \"prev\", \"pager\", \"next\", \"sizes\", \"jumper\"]);\n    var sizeChange = function sizeChange(size) {\n      listQuery.value.limit = size;\n      getList();\n    };\n    var currentChange = function currentChange(page) {\n      listQuery.value.page = page;\n      getList();\n    };\n    //分页\n    //form\n    var formVisible = (0, _vue.ref)(false);\n    var nowId = (0, _vue.ref)(0);\n    var form = (0, _vue.ref)({\n      reply: '',\n      isreply: 0\n    });\n    //对话列表\n    var chatList = (0, _vue.ref)([]);\n    //回复按钮\n    var replyClick = function replyClick(row) {\n      nowId.value = row.userid;\n      getChatList();\n      formVisible.value = true;\n      timer.value = setInterval(function () {\n        getChatList();\n      }, 3000);\n    };\n    //定时器\n    var timer = (0, _vue.ref)(null);\n    var delTimer = function delTimer() {\n      clearInterval(timer.value);\n    };\n    var scrollFlag = (0, _vue.ref)(true);\n    var getChatList = function getChatList() {\n      context === null || context === void 0 ? void 0 : context.$http({\n        url: 'chat/page',\n        method: 'get',\n        params: {\n          limit: 1000,\n          sort: 'addtime',\n          order: 'asc',\n          userid: nowId.value\n        }\n      }).then(function (res) {\n        for (var x in res.data.data.list) {\n          if (res.data.data.list[x].ask) {\n            if (res.data.data.list[x].ask.split('/').length > 1) {\n              if (res.data.data.list[x].ask.split('/')[0] == 'file') {\n                res.data.data.list[x].img = res.data.data.list[x].ask;\n              }\n            }\n          }\n          if (res.data.data.list[x].reply) {\n            if (res.data.data.list[x].reply.split('/').length > 1) {\n              if (res.data.data.list[x].reply.split('/')[0] == 'file') {\n                res.data.data.list[x].img = res.data.data.list[x].reply;\n              }\n            }\n          }\n          if (x == 0) {\n            res.data.data.list[x].showTime = 1;\n          } else {\n            var jian = new Date(res.data.data.list[x].addtime).getTime() - new Date(res.data.data.list[x - 1].addtime).getTime();\n            if (jian > 18000) {\n              res.data.data.list[x].showTime = 1;\n            } else {\n              res.data.data.list[x].showTime = 0;\n            }\n          }\n        }\n        chatList.value = res.data.data.list;\n        (0, _vue.nextTick)(function () {\n          var div = document.getElementsByClassName('chat-content')[0];\n          setTimeout(function () {\n            if (div) {\n              if (div.scrollTop + div.clientHeight == div.scrollHeight || scrollFlag.value) {\n                div.scrollTop = div.scrollHeight;\n                scrollFlag.value = false;\n              }\n            }\n          }, 100);\n        });\n      });\n    };\n    //发送信息\n    var replySave = function replySave() {\n      form.value.userid = nowId.value;\n      if (form.value.reply) {\n        context === null || context === void 0 ? void 0 : context.$http({\n          url: 'chat/save',\n          method: 'post',\n          data: form.value\n        }).then(function (res) {\n          context === null || context === void 0 ? void 0 : context.$toolUtil.message('Successfully sent', 'success', function () {\n            getChatList();\n            form.value.reply = '';\n          });\n        });\n      }\n    };\n    //图片\n    var action = (0, _vue.ref)(\"\".concat(context === null || context === void 0 ? void 0 : context.$config.name, \"/file/upload\"));\n    var askType = (0, _vue.ref)(false);\n    var uploadSuccess = function uploadSuccess(e) {\n      var params = {\n        reply: 'file/' + e.file,\n        userid: nowId.value\n      };\n      context === null || context === void 0 ? void 0 : context.$http({\n        url: 'chat/save',\n        method: 'post',\n        data: params\n      }).then(function (res) {\n        context === null || context === void 0 ? void 0 : context.$toolUtil.message('Successfully sent', 'success', function () {\n          getChatList();\n          form.value.reply = '';\n        });\n      });\n    };\n    var init = function init() {\n      getList();\n    };\n    init();\n    var __returned__ = {\n      context: context,\n      list: list,\n      listQuery: listQuery,\n      listLoading: listLoading,\n      getList: getList,\n      total: total,\n      layouts: layouts,\n      sizeChange: sizeChange,\n      currentChange: currentChange,\n      formVisible: formVisible,\n      nowId: nowId,\n      form: form,\n      chatList: chatList,\n      replyClick: replyClick,\n      timer: timer,\n      delTimer: delTimer,\n      scrollFlag: scrollFlag,\n      getChatList: getChatList,\n      replySave: replySave,\n      action: action,\n      askType: askType,\n      uploadSuccess: uploadSuccess,\n      init: init,\n      reactive: _vue.reactive,\n      ref: _vue.ref,\n      getCurrentInstance: _vue.getCurrentInstance,\n      nextTick: _vue.nextTick,\n      onMounted: _vue.onMounted,\n      get moment() {\n        return _moment[\"default\"];\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};\nexports[\"default\"] = _default;","map":{"version":3,"mappings":"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","names":["context","appContext","config","globalProperties","list","listQuery","page","limit","sort","order","isreply","listLoading","getList","params","value","$http","url","method","then","res","data","total","Number","layouts","sizeChange","size","currentChange","formVisible","nowId","form","reply","chatList","replyClick","row","userid","getChatList","timer","setInterval","delTimer","clearInterval","scrollFlag","x","ask","split","length","img","showTime","jian","Date","addtime","getTime","div","document","getElementsByClassName","setTimeout","scrollTop","clientHeight","scrollHeight","replySave","$toolUtil","message","action","$config","name","askType","uploadSuccess","e","file","init"],"sources":["C:/Users/24831/Desktop/Y/毕业设计/projectB/迭代2/manage_code/src/views/chat/list.vue"],"sourcesContent":["<template>\r\n\t<div>\r\n\t\t<div class=\"center_view\">\r\n\t\t\t<el-table v-loading=\"listLoading\" :data=\"list\" border\r\n\t\t\t\t:stripe='false'>\r\n\t\t\t\t<el-table-column prop=\"ask\" :resizable='true' :sortable='true' align=\"left\" header-align=\"left\" label=\"new message\">\r\n\t\t\t\t\t<template #default=\"scope\">\r\n\t\t\t\t\t\t{{scope.row.ask}}\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-table-column>\r\n\t\t\t\t<el-table-column prop=\"ask\" :resizable='true' :sortable='true' align=\"left\" header-align=\"left\" label=\"state\">\r\n\t\t\t\t\t<template #default=\"scope\">\r\n\t\t\t\t\t\t<el-tag v-if=\"scope.row.isreply==1\" type=\"success\">No response received</el-tag>\r\n\t\t\t\t\t\t<el-tag v-if=\"scope.row.isreply==0\" type=\"info\">Replied</el-tag>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-table-column>\r\n\t\t\t\t<el-table-column prop=\"ask\" :resizable='true' :sortable='true' align=\"left\" header-align=\"left\" label=\"operate\">\r\n\t\t\t\t\t<template #default=\"scope\">\r\n\t\t\t\t\t\t<el-button class=\"edit_btn\" type=\"primary\" @click=\"replyClick(scope.row)\">Reply</el-button>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t</el-table-column>\r\n\t\t\t</el-table>\r\n\t\t\t<el-pagination\r\n\t\t\t\tbackground\r\n\t\t\t\t:layout=\"layouts.join(',')\"\r\n\t\t\t\t:total=\"total\" \r\n\t\t\t\t:page-size=\"listQuery.limit\"\r\n                v-model:current-page=\"listQuery.page\"\r\n\t\t\t\tprev-text=\"Previous page\"\r\n\t\t\t\tnext-text=\"Next page\"\r\n\t\t\t\t:hide-on-single-page=\"false\"\r\n\t\t\t\t:style='{}'\r\n\t\t\t\t@size-change=\"sizeChange\"\r\n\t\t\t\t@current-change=\"currentChange\"  />\r\n\t\t\t<el-dialog v-model=\"formVisible\" title=\"Reply\" width=\"70%\" destroy-on-close @close=\"delTimer\">\r\n\t\t\t\t<el-form ref=\"formRef\" :model=\"form\" class=\"chat_view\">\r\n\t\t\t\t\t<div class=\"chat-content\">\r\n\t\t\t\t\t\t<div class=\"chat-item\" :key=\"item.id\" v-for=\"(item,index) in chatList\">\r\n\t\t\t\t\t\t\t<div class=\"chat_time\" v-if=\"item.showTime\">{{item.addtime}}</div>\r\n\t\t\t\t\t\t\t<div v-if=\"item.ask\" class=\"left-content\">\r\n\t\t\t\t\t\t\t\t<el-alert v-if=\"!item.img\" class=\"text-content\" :title=\"item.ask\" :closable=\"false\"\r\n\t\t\t\t\t\t\t\t\ttype=\"success\"></el-alert>\r\n                                <video v-else-if=\"item.ask.endsWith('.mp4')\" controls style=\"width: 200px;height: 160px\">\r\n                                    <source  :src=\"$config.url + item.ask\">\r\n                                </video>\r\n\t\t\t\t\t\t\t\t<el-image v-if=\"item.img\" :src=\"$config.url + item.img\"\r\n\t\t\t\t\t\t\t\t\tclass=\"chat_img\" fit=\"scale-down\"\r\n\t\t\t\t\t\t\t\t\t:preview-src-list=\"[$config.url + item.img]\"></el-image>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div v-else class=\"right-content\">\r\n\t\t\t\t\t\t\t\t<el-alert v-if=\"!item.img\" class=\"text-content\" :title=\"item.reply\" :closable=\"false\"\r\n\t\t\t\t\t\t\t\t\ttype=\"warning\"></el-alert>\r\n                                <video v-else-if=\"item.reply.endsWith('.mp4')\" controls style=\"width: 200px;height: 160px\">\r\n                                    <source  :src=\"$config.url + item.reply\">\r\n                                </video>\r\n\t\t\t\t\t\t\t\t<el-image v-if=\"item.img\" :src=\"$config.url + item.img\"\r\n\t\t\t\t\t\t\t\t\tclass=\"chat_img\" fit=\"scale-down\"\r\n\t\t\t\t\t\t\t\t\t:preview-src-list=\"[$config.url + item.img]\"></el-image>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div class=\"clear-float\"></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"input_box\">\r\n\t\t\t\t\t\t<el-input class=\"input\" v-model=\"form.reply\" placeholder=\"Please reply\" type=\"textarea\" />\r\n\t\t\t\t\t\t<img src=\"http://chy2.gdnxeco.com/20230912/f60a0c39a6d34289b50c151949711b67.png\" class=\"inp_add\"\r\n\t\t\t\t\t\t\t@click=\"askType=!askType\" alt=\"\">\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"upload_box\" v-if=\"askType\">\r\n\t\t\t\t\t\t<el-upload class=\"upload-demo\" :action=\"action\" :on-success=\"uploadSuccess\"\r\n\t\t\t\t\t\t\t:show-file-list=\"false\" accept=\"image/*,.mp4\">\r\n\t\t\t\t\t\t\t<el-button type=\"primary\">Upload files</el-button>\r\n\t\t\t\t\t\t</el-upload>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"save_box\">\r\n\t\t\t\t\t\t<el-button type=\"primary\" @click=\"replySave\">Send</el-button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</el-form>\r\n\t\t\t</el-dialog>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\treactive,\r\n\t\tref,\r\n\t\tgetCurrentInstance,\r\n\t\tnextTick,\r\n\t\tonMounted,\r\n\t} from 'vue'\r\n    import moment from \"moment\"\r\n\tconst context = getCurrentInstance()?.appContext.config.globalProperties;\r\n\tconst list = ref([])\r\n\tconst listQuery = ref({\r\n\t\tpage: 1,\r\n\t\tlimit: 20,\r\n\t\tsort: 'id',\r\n\t\torder: 'desc',\r\n\t\tisreply: 1\r\n\t})\r\n\tconst listLoading = ref(false)\r\n\t//获取列表\r\n\tconst getList = () => {\r\n\t\tlet params = listQuery.value\r\n\t\tlistLoading.value = true\r\n\t\tcontext?.$http({\r\n\t\t\turl: 'chat/page',\r\n\t\t\tmethod: 'get',\r\n\t\t\tparams: params\r\n\t\t}).then(res => {\r\n\t\t\tlistLoading.value = false\r\n\t\t\tlist.value = res.data.data.list\r\n\t\t\ttotal.value = Number(res.data.data.total)\r\n\t\t})\r\n\t}\r\n\t//分页\r\n\tconst total = ref(0)\r\n\tconst layouts = ref([\"total\",\"prev\",\"pager\",\"next\",\"sizes\",\"jumper\"])\r\n\tconst sizeChange = (size) => {\r\n\t\tlistQuery.value.limit = size\r\n\t\tgetList()\r\n\t}\r\n\tconst currentChange = (page) => {\r\n\t\tlistQuery.value.page = page\r\n\t\tgetList()\r\n\t}\r\n\t//分页\r\n\t//form\r\n\tconst formVisible = ref(false)\r\n\tconst nowId = ref(0)\r\n\tconst form = ref({\r\n\t\treply: '',\r\n        isreply: 0,\r\n\t})\r\n\t//对话列表\r\n\tconst chatList = ref([])\r\n\t//回复按钮\r\n\tconst replyClick = (row) => {\r\n\t\tnowId.value = row.userid\r\n\t\tgetChatList()\r\n\t\tformVisible.value = true\r\n\t\ttimer.value = setInterval(() => {\r\n\t\t\tgetChatList()\r\n\t\t}, 3000)\r\n\t}\r\n\t//定时器\r\n\tconst timer = ref(null)\r\n\tconst delTimer = () => {\r\n\t\tclearInterval(timer.value)\r\n\t}\r\n    const scrollFlag = ref(true)\r\n\tconst getChatList = () => {\r\n\t\tcontext?.$http({\r\n\t\t\turl: 'chat/page',\r\n\t\t\tmethod: 'get',\r\n\t\t\tparams: {\r\n\t\t\t\tlimit: 1000,\r\n\t\t\t\tsort: 'addtime',\r\n\t\t\t\torder: 'asc',\r\n\t\t\t\tuserid: nowId.value\r\n\t\t\t}\r\n\t\t}).then(res => {\r\n\t\t\tfor (let x in res.data.data.list) {\r\n\t\t\t\tif (res.data.data.list[x].ask) {\r\n\t\t\t\t\tif (res.data.data.list[x].ask.split('/').length > 1) {\r\n\t\t\t\t\t\tif (res.data.data.list[x].ask.split('/')[0] == 'file') {\r\n\t\t\t\t\t\t\tres.data.data.list[x].img = res.data.data.list[x].ask\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (res.data.data.list[x].reply) {\r\n\t\t\t\t\tif (res.data.data.list[x].reply.split('/').length > 1) {\r\n\t\t\t\t\t\tif (res.data.data.list[x].reply.split('/')[0] == 'file') {\r\n\t\t\t\t\t\t\tres.data.data.list[x].img = res.data.data.list[x].reply\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(x==0){\r\n\t\t\t\t\tres.data.data.list[x].showTime = 1\r\n\t\t\t\t}else{\r\n\t\t\t\t\tlet jian = new Date(res.data.data.list[x].addtime).getTime() - new Date(res.data.data.list[x-1].addtime).getTime()\r\n\t\t\t\t\tif(jian>18000){\r\n\t\t\t\t\t\tres.data.data.list[x].showTime = 1\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tres.data.data.list[x].showTime = 0\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tchatList.value = res.data.data.list\r\n\t\t\tnextTick(() => {\r\n\t\t\t\tlet div = document.getElementsByClassName('chat-content')[0]\r\n\t\t\t\tsetTimeout(() => {\r\n                    if (div){\r\n                        if(div.scrollTop+div.clientHeight==div.scrollHeight || scrollFlag.value){\r\n                            div.scrollTop = div.scrollHeight\r\n                            scrollFlag.value = false\r\n                        }\r\n                    }\r\n\t\t\t\t}, 100)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\t//发送信息\r\n\tconst replySave = () => {\r\n\t\tform.value.userid = nowId.value\r\n\t\tif (form.value.reply) {\r\n\t\t\tcontext?.$http({\r\n\t\t\t\turl: 'chat/save',\r\n\t\t\t\tmethod: 'post',\r\n\t\t\t\tdata: form.value\r\n\t\t\t}).then(res => {\r\n\t\t\t\tcontext?.$toolUtil.message('Successfully sent', 'success', () => {\r\n\t\t\t\t\tgetChatList()\r\n\t\t\t\t\tform.value.reply = ''\r\n\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\t//图片\r\n\tconst action = ref(`${context?.$config.name}/file/upload`)\r\n\tconst askType = ref(false)\r\n\tconst uploadSuccess = (e) => {\r\n\r\n\t\tlet params = {\r\n\t\t\treply: 'file/' + e.file,\r\n\t\t\tuserid: nowId.value\r\n\t\t}\r\n\t\tcontext?.$http({\r\n\t\t\turl: 'chat/save',\r\n\t\t\tmethod: 'post',\r\n\t\t\tdata: params\r\n\t\t}).then(res => {\r\n\t\t\tcontext?.$toolUtil.message('Successfully sent', 'success', () => {\r\n\t\t\t\tgetChatList()\r\n\t\t\t\tform.value.reply = ''\r\n\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\tconst init = () => {\r\n\t\tgetList()\r\n\t}\r\n\tinit()\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n\t// 表格样式\r\n\t.el-table {\r\n\t\t:deep(.el-table__header-wrapper) {\r\n\t\t\tthead {\r\n\t\t\t\ttr {\r\n\t\t\t\t\tth {\r\n\t\t\t\t\t\t.cell {\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t:deep(.el-table__body-wrapper) {\r\n\t\t\ttbody {\r\n\t\t\t\ttr {\r\n\t\t\t\t\ttd {\r\n\t\t\t\t\t\t.cell {\r\n\t\t\t\t\t\t\t// 回复\r\n\t\t\t\t\t\t\t.el-button--primary {\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// 回复-悬浮\r\n\t\t\t\t\t\t\t.el-button--primary:hover {\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttr:hover {\r\n\t\t\t\t\ttd {\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// 分页器\r\n\t.el-pagination {\r\n\t\t// 总页码\r\n\t\t:deep(.el-pagination__total) {\r\n\t\t}\r\n\t\t// 上一页\r\n\t\t:deep(.btn-prev) {\r\n\t\t}\r\n\t\t// 下一页\r\n\t\t:deep(.btn-next) {\r\n\t\t}\r\n\t\t// 上一页禁用\r\n\t\t:deep(.btn-prev:disabled) {\r\n\t\t}\r\n\t\t// 下一页禁用\r\n\t\t:deep(.btn-next:disabled) {\r\n\t\t}\r\n\t\t// 页码\r\n\t\t:deep(.el-pager) {\r\n\t\t\t// 数字\r\n\t\t\t.number {\r\n\t\t\t}\r\n\t\t\t// 数字悬浮\r\n\t\t\t.number:hover {\r\n\t\t\t}\r\n\t\t\t// 选中\r\n\t\t\t.number.active {\r\n\t\t\t}\r\n\t\t}\r\n\t\t// sizes\r\n\t\t:deep(.el-pagination__sizes) {\r\n\t\t\tdisplay: inline-block;\r\n\t\t\tvertical-align: top;\r\n\t\t\tfont-size: 13px;\r\n\t\t\tline-height: 28px;\r\n\t\t\theight: 28px;\r\n\t\t\t.el-select {\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 跳页\r\n\t\t:deep(.el-pagination__jump) {\r\n\t\t\t// 输入框\r\n\t\t\t.el-input {\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// 聊天总盒子\r\n\t.chat_view {\r\n\t\t// 聊天内容盒子\r\n\t\t.chat-content {\r\n\t\t\t// 聊天时间\r\n\t\t\t.chat_time{\r\n\t\t\t}\r\n\t\t\t// 提问盒子\r\n\t\t\t.left-content {\r\n\t\t\t\t// 文字样式\r\n\t\t\t\t:deep(.el-alert--success){\r\n\t\t\t\t\t.el-alert__title {\r\n\t\t\t\t\t\tfont-size: inherit;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 聊天图片\r\n\t\t\t\t.chat_img {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 回复盒子\r\n\t\t\t.right-content {\r\n\t\t\t\t// 文字样式\r\n\t\t\t\t:deep(.el-alert--warning){\r\n\t\t\t\t\t.el-alert__title {\r\n\t\t\t\t\t\tfont-size: inherit;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// 聊天图片\r\n\t\t\t\t.chat_img {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 输入内容盒子\r\n\t\t.input_box{\r\n\t\t\t// 输入框\r\n\t\t\t:deep(.el-textarea__inner) {\r\n\t\t\t}\r\n\t\t\t// operate按钮\r\n\t\t\t.inp_add {\r\n\t\t\t}\r\n\t\t}\r\n\t\t// operate盒子\r\n\t\t.upload_box {\r\n\t\t\t:deep(.upload-demo) {\r\n\t\t\t\t// 按钮\r\n\t\t\t\t.el-button--primary {\r\n\t\t\t\t}\r\n\t\t\t\t// 按钮悬浮\r\n\t\t\t\t.el-button--primary:hover {\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// 发送盒子\r\n\t\t.save_box {\r\n\t\t\t// 按钮\r\n\t\t\t:deep(.el-button--primary) {\r\n\t\t\t}\r\n\t\t\t// 按钮悬浮\r\n\t\t\t:deep(.el-button--primary:hover) {\r\n\t\t\t}\r\n\t\t}\r\n\t\t.clear-float {\r\n\t\t\tclear: both;\r\n\t\t}\r\n\t}\r\n</style>\r\n<style>\r\n.el-dialog{\r\n    width: 50% !important;\r\n}\r\n/* 总盒子 */\r\n.chat_view {\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin: 30px 0px;\r\n    padding: 0px;\r\n    background: rgb(255, 255, 255);\r\n    border: 0px solid rgb(221, 221, 221);\r\n    border-radius: 4px;\r\n    font-size: 16px;\r\n}\r\n/* 聊天列表 盒子 */\r\n.chat_view .chat-content{\r\n    margin: 0px 0px 30px;\r\n    padding: 0px 0px 30px;\r\n    max-height: 300px;\r\n    height: 300px;\r\n    overflow-y: scroll;\r\n    border: 1px solid rgb(221, 221, 221) !important;\r\n    background: rgb(255, 255, 255) !important;\r\n    border-radius: 0px;\r\n}\r\n/* 时间 */\r\n.chat_view .chat-content .chat-item .chat_time{\r\n    width: 100%;\r\n    text-align: center;\r\n    font-size: 16px;\r\n    color: rgb(153, 153, 153);\r\n    padding: 6px 0px;\r\n}\r\n/* 提问 盒子 */\r\n.chat_view .chat-content .chat-item .left-content{\r\n    float: left;\r\n    margin: 0px 0px 10px;\r\n    padding: 10px;\r\n}\r\n/* 内容 */\r\n.chat_view .chat-content .chat-item .left-content .text-content{\r\n    background-color: rgb(240, 249, 235);\r\n    color: rgb(103, 194, 58);\r\n}\r\n/* 图片 */\r\n.chat_view .chat-content .chat-item .left-content .chat_img{\r\n    width: 120px;\r\n    margin: 10px;\r\n}\r\n/* 回复 盒子 */\r\n.chat_view .chat-content .chat-item .right-content{\r\n    float: right;\r\n    margin: 0px 0px 10px;\r\n    padding: 10px;\r\n}\r\n/* 内容 */\r\n.chat_view .chat-content .chat-item .right-content .text-content{\r\n    background-color: rgb(253, 246, 236);\r\n    color: rgb(230, 162, 60);\r\n}\r\n/* 图片 */\r\n.chat_view .chat-content .chat-item .right-content .chat_img{\r\n    width: 120px;\r\n    margin: 10px;\r\n}\r\n\r\n/* operate栏 盒子 */\r\n.chat_view .input_box{\r\n    display: flex;\r\n    align-items: center;\r\n}\r\n/* 输入框 盒子 */\r\n.chat_view .input_box .el-textarea{\r\n    position: relative;\r\n    display: inline-block;\r\n    width: 100%;\r\n    vertical-align: bottom;\r\n    font-size: 14px;\r\n}\r\n/* 输入框 */\r\n.chat_view .input_box .el-textarea .el-textarea__inner{\r\n    min-height: 120px !important;\r\n}\r\n/* 加号 */\r\n.chat_view .input_box .inp_add{\r\n    width: 36px;\r\n    cursor: pointer;\r\n    margin: 0px 0px 0px 10px;\r\n}\r\n\r\n/* 上传 盒子 */\r\n.chat_view .upload_box{\r\n    display: flex;\r\n    align-items: center;\r\n    width: 100%;\r\n    justify-content: space-around;\r\n    margin: 20px 0px 0px;\r\n}\r\n/* 按钮 */\r\n.chat_view .upload_box .el-button--primary{\r\n    margin: 0px 10px 0px 0px;\r\n    padding: 0px 24px;\r\n    width: auto;\r\n    height: 36px;\r\n    font-size: 14px;\r\n    color: rgb(255, 255, 255);\r\n    border-radius: 0px;\r\n    border: 0px solid rgb(252, 203, 130);\r\n    background: rgb(59, 182, 43);\r\n    cursor: pointer;\r\n}\r\n/* 悬浮 */\r\n.chat_view .upload_box .el-button--primary:hover{\r\n}\r\n\r\n/* 按钮 盒子 */\r\n.chat_view .save_box{\r\nwidth: 100%;\r\n    display: flex;\r\n    margin: 10px 0px 0px;\r\n}\r\n/* 按钮 */\r\n.chat_view .save_box .el-button--primary{\r\n    margin: 0px 10px 0px 0px;\r\n    padding: 0px 24px;\r\n    width: auto;\r\n    height: 36px;\r\n    font-size: 14px;\r\n    color: rgb(255, 255, 255);\r\n    border-radius: 0px;\r\n    border: 0px solid rgb(252, 203, 130);\r\n    background: var(--theme);\r\n    cursor: pointer;\r\n    min-width: 110px;\r\n}\r\n/* 悬浮 */\r\n.chat_view .save_box .el-button--primary:hover{\r\n}\r\n\r\n</style>"]},"metadata":{},"sourceType":"script","externalDependencies":[]}